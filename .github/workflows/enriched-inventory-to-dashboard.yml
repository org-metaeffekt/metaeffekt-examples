name: Enriched inventory to dashboard

on:
  workflow_dispatch:
    inputs:
     inventory:
        description: "The enriched input inventory path."
        required: true
        default: keycloak-25.0.4/03-advised/keycloak-25.0.4-advised.xls

  workflow_call:
    inputs:
      inventory:
        description: "The enriched input inventory path."
        required: true
        type: string

    outputs:
      dashboard:
        value: ${{ jobs.enriched-inventory-to-dashboard.steps.create-dashboard.dashboard }}

jobs:
  enriched-inventory-to-dashboard:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup java environment
      uses: actions/setup-java@v4
      with:
        java-version: '8'
        distribution: 'zulu'
        cache: 'maven'
        cache-dependency-path: './processors/processor-parent.xml'

    - name: Configure container
      uses: ./.github/actions/configure/container

    - name: Get vulnerability index
      id: get-index
      uses: ./.github/actions/mirror/download-vulnerability-index

    - name: Process Input
      id: process-input
      uses: ./.github/actions/configure/file
      with:
        file-path: ${{ inputs.inventory }}

    - name: Create dashboard
      id: create-dashboard
      uses: ./.github/actions/advise/create-dashboard
      with:
        input-inventory: ${{ inputs.enriched-inventory }}
        input-database: ${{ steps.get-index.outputs.index-directory }}
        output-dashboard: ../${{ steps.process-input.outputs.asset-name }}/03-advised/${{ steps.process-input.outputs.asset-name }}-dashboard.html

    - uses: ./.github/actions/configure/git # Configures git and pushes changes.
