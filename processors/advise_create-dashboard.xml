<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.metaeffekt.examples.processor</groupId>
        <artifactId>processor-parent</artifactId>
        <version>EXAMPLES-SNAPSHOT</version>
        <relativePath>processor-parent.xml</relativePath>
    </parent>

    <artifactId>advise_create-dashboard</artifactId>
    <packaging>pom</packaging>

    <properties>

        <input.database>${project.basedir}/../../.database/ae-vulnerability-mirror</input.database>

        <output.inventory.dir>${project.build.directory}/classes/inventory/</output.inventory.dir>
        <output.inventory.intermediate.dir>${project.build.directory}/classes/inventory-intermediate/
        </output.inventory.intermediate.dir>
        <output.inventory.name>${project.artifactId}-inventory.xls</output.inventory.name>
        <output.inventory>${output.inventory.dir}/${output.inventory.name}</output.inventory>
        <output.inventory.correlation>${output.inventory.dir}/correlation-${output.inventory.name}
        </output.inventory.correlation>
        <output.dashboard>${project.build.directory}/classes/dashboard/${project.artifactId}-dashboard.html
        </output.dashboard>
        <output.svg>${project.build.directory}/classes/resources/svg</output.svg>

        <inventory.id>ae-inventory</inventory.id>

        <ae.dashboard.timeline>true</ae.dashboard.timeline>
        <ae.dashboard.timeline.vulnerabilities.limit>2147483647</ae.dashboard.timeline.vulnerabilities.limit>

        <correlation.dir>../correlation</correlation.dir>

        <keywords.dir>../context</keywords.dir>
        <keywords.labels/>

        <assessment.dir>${project.basedir}/assessment</assessment.dir>
        <vulnerabilities.custom.dir>${project.basedir}/custom-vulnerabilities</vulnerabilities.custom.dir>

        <assessment.labels/>

        <activate.msrc>true</activate.msrc>
        <activate.nvd>true</activate.nvd>
        <activate.certfr>true</activate.certfr>
        <activate.certeu>true</activate.certeu>
        <activate.certsei>true</activate.certsei>
        <activate.ghsa.correlation>true</activate.ghsa.correlation>
        <activate.ghsa>true</activate.ghsa>
        <activate.correlation>true</activate.correlation>
        <activate.status>true</activate.status>
        <activate.keywords>true</activate.keywords>
        <activate.validation>true</activate.validation>
        <activate.dashboard>true</activate.dashboard>
        <activate.vulnerabilities.custom>true</activate.vulnerabilities.custom>

        <ae.advisor.phase>process-resources</ae.advisor.phase>

        <dashboard.title>Vulnerability Assessment Dashboard</dashboard.title>
        <dashboard.subtitle>${project.artifactId}</dashboard.subtitle>
        <dashboard.footer>${project.artifactId}</dashboard.footer>
    </properties>

    <build>
        <plugins>
            <plugin>
                <groupId>org.metaeffekt.core</groupId>
                <artifactId>ae-inventory-maven-plugin</artifactId>
                <version>${ae.core.version}</version>
                <executions>
                    <execution>
                        <id>enrich-with-reference-inventory</id>
                        <phase>process-sources</phase>
                        <goals>
                            <goal>create-inventory-report</goal>
                        </goals>
                        <configuration>
                            <inventory>${input.inventory}</inventory>
                            <sourceInventoryDir>../.github/actions/convert/cyclonedx-to-inventory/</sourceInventoryDir>
                            <sourceInventoryIncludes>inventory/*.xls</sourceInventoryIncludes>
                            <failOnError>false</failOnError>
                            <failOnUnknown>false</failOnUnknown>

                            <targetInventoryDir>${project.build.directory}/inventories/</targetInventoryDir>
                            <targetInventoryPath>01_${project.artifactId}-inventory_ref.xls</targetInventoryPath>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

    <profiles>
        <profile>
            <id>advise-correlate</id>
            <activation> <!-- activate by default, unless disabled via -P-advise-correlate -->
                <activeByDefault>true</activeByDefault>
            </activation>
            <build>
                    <plugins>
                        <plugin>
                            <groupId>com.metaeffekt.artifact.analysis</groupId>
                            <artifactId>ae-inventory-enrichment-plugin</artifactId>
                            <version>${ae.artifact.analysis.version}</version>

                            <executions>
                                <execution>
                                    <id>set-inventory-info</id>
                                    <phase>generate-resources</phase>
                                    <goals>
                                        <goal>set-inventory-info</goal>
                                    </goals>
                                    <configuration>
                                        <active>true</active>

                                        <entryId>vad-customization</entryId>
                                        <values>
                                            <Title>${dashboard.title}</Title>
                                            <Subtitle>${dashboard.subtitle}</Subtitle>
                                            <Footer>${dashboard.footer}</Footer>
                                        </values>

                                        <inventoryInputFile>${input.inventory}</inventoryInputFile>
                                        <inventoryOutputFile>${input.inventory}</inventoryOutputFile>
                                    </configuration>
                                </execution>


                                <execution>
                                    <id>inventory-enrichment-advise-correlate-execution</id>
                                    <phase>generate-resources</phase>
                                    <goals>
                                        <goal>enrich-inventory</goal>
                                    </goals>
                                    <configuration>
                                        <inventoryInputFile>${input.inventory}</inventoryInputFile>
                                        <inventoryOutputFile>${output.inventory.correlation}</inventoryOutputFile>
                                        <mirrorDirectory>${input.database}</mirrorDirectory>

                                        <writeIntermediateInventories>false</writeIntermediateInventories>
                                        <storeIntermediateStepsInInventoryInfo>false</storeIntermediateStepsInInventoryInfo>
                                    </configuration>
                                </execution>
                            </executions>
                        </plugin>
                    </plugins>
            </build>
        </profile>
        <profile>
            <id>advise-vulnerability</id>
            <activation> <!-- activate by default, unless disabled via -P-advise-vulnerability -->
                <activeByDefault>true</activeByDefault>
            </activation>
            <build>
                    <plugins>
                        <plugin>
                            <groupId>com.metaeffekt.artifact.analysis</groupId>
                            <artifactId>ae-inventory-enrichment-plugin</artifactId>
                            <version>${ae.artifact.analysis.version}</version>

                            <executions>
                                <execution>
                                    <id>inventory-enrichment-advise-vulnerability-execution</id>
                                    <goals>
                                        <goal>enrich-inventory</goal>
                                    </goals>

                                    <configuration>
                                        <inventoryInputFile>${output.inventory.correlation}</inventoryInputFile>
                                        <inventoryOutputFile>${output.inventory}</inventoryOutputFile>
                                        <mirrorDirectory>${input.database}</mirrorDirectory>

                                        <writeIntermediateInventories>false</writeIntermediateInventories>
                                        <storeIntermediateStepsInInventoryInfo>false</storeIntermediateStepsInInventoryInfo>

                                        <vulnerabilityAssessmentDashboardEnrichment>
                                            <active>${activate.dashboard}</active>
                                            <outputDashboardFile>${output.dashboard}</outputDashboardFile>
                                            <svgDirectory>${output.svg}</svgDirectory>

                                            <vulnerabilityIncludeFilter></vulnerabilityIncludeFilter>
                                            <maximumVulnerabilitiesPerDashboardCount>2147483647
                                            </maximumVulnerabilitiesPerDashboardCount>

                                            <vulnerabilityTimelinesGlobalEnabled>${ae.dashboard.timeline}
                                            </vulnerabilityTimelinesGlobalEnabled>
                                            <maximumCpeForTimelinesPerVulnerability>2147483647
                                            </maximumCpeForTimelinesPerVulnerability>
                                            <maximumVulnerabilitiesPerTimeline>
                                                ${ae.dashboard.timeline.vulnerabilities.limit}
                                            </maximumVulnerabilitiesPerTimeline>
                                            <vulnerabilityTimelineHideIrrelevantVersions>true
                                            </vulnerabilityTimelineHideIrrelevantVersions>
                                            <maximumVersionsPerTimeline>2147483647</maximumVersionsPerTimeline>
                                            <maximumTimeSpentOnTimelines>2147483647</maximumTimeSpentOnTimelines>

                                            <failOnVulnerabilityWithoutSpecifiedRisk>true
                                            </failOnVulnerabilityWithoutSpecifiedRisk>
                                            <failOnUnreviewedAdvisories>true</failOnUnreviewedAdvisories>
                                            <failOnUnreviewedAdvisoriesTypes></failOnUnreviewedAdvisoriesTypes>
                                        </vulnerabilityAssessmentDashboardEnrichment>
                                    </configuration>
                                </execution>
                            </executions>
                        </plugin>
                    </plugins>
            </build>
        </profile>
    </profiles>
</project>
